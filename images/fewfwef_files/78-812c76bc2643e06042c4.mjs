(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[78,"sterlingAPI"],{LeWa:function(e,t,n){n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s}));n("q1tI");var o=n("QkVN"),r=n.n(o);const i={text:"",srcUrl:"",canonicalUrl:"",imageSignature:"",imageUrl:"",isFetching:!1},s={backgroundColor:"#ffffff",blockIds:[],canvasJson:null,coverImgSignature:"",description:"",descriptionError:null,dominantColors:[],layout:null,linkBlock:i,linkError:null,media:null,selectedBlockId:null,signals:{},title:"",titleError:null};t.a=(e=s,t)=>{switch(t.type){case"PIN_DRAFT_ADD_STORY_PIN_ITEM":case"STORY_PIN_ITEM_UPDATE_DATA":{const{pinItem:n}=t.payload;return{...e,...n}}case"STORY_PIN_ITEM_SET_DESCRIPTION":{const{description:n}=t.payload;return{...e,description:n}}case"STORY_PIN_ITEM_SET_DESCRIPTION_ERROR":{const{descriptionError:n}=t.payload;return{...e,descriptionError:n}}case"STORY_PIN_ITEM_UPDATE_LINK_BLOCK":{const{linkBlock:n}=t.payload;return{...e,linkBlock:{...e.linkBlock,...n}}}case"STORY_PIN_ITEM_SET_LINK_ERROR":{const{linkError:n}=t.payload;return{...e,linkError:n}}case"STORY_PIN_ITEM_SET_MEDIA":{const{media:n}=t.payload;return{...e,media:n,canvasJson:null}}case"STORY_PIN_ITEM_UPDATE_MEDIA":{const{media:n}=t.payload;return{...e,media:e.media?r()({},e.media,n):null}}case"STORY_PIN_ITEM_SET_TITLE":{const{title:n}=t.payload;return{...e,title:n}}case"STORY_PIN_ITEM_SET_TITLE_ERROR":{const{titleError:n}=t.payload;return{...e,titleError:n}}case"STORY_PIN_ITEM_SET_EDITED_IMAGE":{const{editedMedia:n,canvasJson:o}=t.payload;return{...e,media:n,canvasJson:o}}case"STORY_PIN_ITEM_SET_SELECTED_BLOCK_ID":{const{blockId:n}=t.payload;return{...e,selectedBlockId:n}}case"STORY_PIN_ITEM_SET_BACKGROUND_COLOR":{const{backgroundColor:n}=t.payload;return{...e,backgroundColor:n}}case"STORY_PIN_ITEM_SET_COVER_IMAGE_SIGNATURE":{const{coverImgSignature:n}=t.payload;return{...e,coverImgSignature:n}}case"STORY_PIN_ITEM_SET_LAYOUT":{const{layout:n}=t.payload;return{...e,layout:n}}case"STORY_PIN_ITEM_SET_DOMINANT_COLORS":{const{dominantColors:n}=t.payload;return{...e,dominantColors:n}}case"STORY_PIN_ITEM_ADD_BLOCK":{const{blockId:n}=t.payload,{blockIds:o}=e;return{...e,blockIds:[...o,n]}}case"STORY_PIN_ITEM_REMOVE_BLOCK":{const{blockId:n}=t.payload,{blockIds:o}=e;return{...e,blockIds:[...o.filter(e=>e!==n)]}}default:return e}}},MhBu:function(e,t,n){function o(e){return{type:"FEED_ITEMS_REMOVED",payload:e}}n.d(t,"a",(function(){return o}))},ZVWG:function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));const o=(e,t)=>{const n=/^\d{1,3}\.\d{1,3}(?:\.\d{1,6})?$/;if(!e.match(n)||!t.match(n))return null;const o=e.split("."),r=t.split("."),i=Math.max(o.length,r.length);for(let s=0;s<i;s+=1){const e=s<o.length?parseInt(o[s],10):0,t=s<r.length?parseInt(r[s],10):0;if(e<t)return-1;if(e>t)return 1}return 0};function r(e,t,n,o,r,i,s,a){const c=document.createElement("div");if("undefined"==typeof document||!document.body)return 0;document.body.appendChild(c);let l=t;const u={fontFamily:n,fontSize:`${l}px`,letterSpacing:`${r}px`,lineHeight:`${o}`,visibility:"hidden",width:`${s}px`};Object.assign(c.style,u);const d=document.createElement("div");for(d.style.display="inline",c.appendChild(d),e.forEach((t,n)=>{const o=document.createElement("span");o.style.wordBreak="break-word",a&&(o.style.padding=a),d.appendChild(o),o.appendChild(document.createTextNode(t)),n!==e.length-1&&o.appendChild(document.createElement("br"))});d.offsetHeight>i&&l>0;)l-=1,c.style.fontSize=`${l}px`;return d.remove(),c.remove(),l}},"bo/h":function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));const o="0.4.0";function r(e=1){return`${.1*e}em 0.2em`}},c50B:function(e,t,n){n.d(t,"n",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"m",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"l",(function(){return u})),n.d(t,"p",(function(){return d})),n.d(t,"j",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"g",(function(){return f})),n.d(t,"h",(function(){return m})),n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return _})),n.d(t,"r",(function(){return y})),n.d(t,"o",(function(){return b})),n.d(t,"k",(function(){return E})),n.d(t,"q",(function(){return I})),n.d(t,"s",(function(){return T}));const o=e=>{const t={"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9","　":" "},n=String(e).split("");return n.forEach((e,o)=>{const r=t[e];r&&(n[o]=r)}),n.join("")};function r(e){return function(t,n){const o=[];t&&/\S/.test(t)||o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}const i=new RegExp(["(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*",'|^"([\\001-\\010\\013\\014\\016-\\037!#-\\[\\]-\\177]|\\\\[\\001-\\011\\013\\014\\016-\\177])*"',")@((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+[A-Z]{2,20}$)","|\\[(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}\\]$"].join(""),"i");function s(e){return function(t,n){const o=[];(t=t&&t.trim())&&!t.match(i)&&o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function a(e){return function(t,n){const r=o(t.trim()),i=[];r&&""!==r&&r.length<2&&i.push(e.ageTooShortString);const s=Math.floor(parseInt(r,10));""===r||/^\d+$/.test(r)&&s>0&&s<300||i.push(e.invalidAgeString);const a={errors:i,warnings:[]};return n&&n(a),a}}function c(e){return function(t,n){const o=(t=t&&t.trim()).replace(/[\(\)\+\-\. ]/g,""),r=[],i=!1!==e.checkLength&&o.length<7;!t||t.match(/^(\(?\+?[0-9]*\)?)?[0-9_\- \.\(\)]*$/g)&&!i||r.push(e.message);const s={errors:r,warnings:[]};return n&&n(s),s}}function l(e){return function(t,n){const r=/^\d+$/,i=[];"number"==typeof t||"string"==typeof t&&(t=t&&t.trim(),(t=o(t))&&!t.match(r)&&i.push(e.message));const s={errors:i,warnings:[]};return n&&n(s),s}}function u(e){return function(t,n){const r=/^[\d\ -]+$/,i=[];"number"==typeof t||"string"==typeof t&&(t=t&&t.trim(),(t=o(t))&&!t.match(r)&&i.push(e.message));const s={errors:i,warnings:[]};return n&&n(s),s}}function d(e){return function(t,n){const o=[];t&&!t.match(/^(https?:\/\/){0,1}[a-z0-9_\-]+\..+/gi)&&o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function h(e){return function(t,n){const o=[];(e.should_trim||!1)&&(t=t&&t.trim());const r=t.length;e.min&&r<e.min?o.push(e.minErrorString):e.max&&r>e.max&&o.push(e.maxErrorString);const i={errors:o,warnings:[]};return n&&n(i),i}}function p(e){return function(t,n){const o=[];t!==(e&&e.targetValue)&&o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function f(e){return function(t,n){t&&(t=parseFloat(t));const o=[];t<=e.value&&o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function m(e){return function(t,n){t&&(t=parseFloat(t));const o=[];t<e.value&&o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function g(e){return function(t,n){const o=[];/^[\040-\176]*$/.test(t)||o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function _(e){return function(t,n){const o=e.hasFractionalCents?/^\d*(\.\d\d?\d?)?$/:/^\d*(\.\d\d?)?$/,r=[];"number"==typeof t&&(t=t.toString()),t&&!t.match(o)&&(t=t&&t.trim(),r.push(e.message));const i={errors:r,warnings:[]};return n&&n(i),i}}function y(e){return function(t,n){t=t&&t.trim();const o=[],r=new Date(t);t&&!r.getTime()&&o.push(e.message);const i={errors:o,warnings:[]};return n&&n(i),i}}function b(e){return function(t,n){const o=[];(t=t&&t.trim())&&!t.match(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/)&&o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function E(e){return function(t,n){const o=[];e.pattern.test(t)||o.push(e.message);const r={errors:o,warnings:[]};return n&&n(r),r}}function I(e,t){const n=e.map(e=>e(t).errors);return[].concat(...n)}function T(e,t){let n="";return t.some(t=>{const o=t(e);return o.errors.length>0&&(n=o.errors[0],!0)}),n}},dtqy:function(e,t,n){var o=n("q1tI"),r=n.n(o),i=n("/MKj"),s=n("qWlA"),a=n("5S2N"),c=n("fArA"),l=n("U4JR");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=Object(c.compose)(Object(i.connect)(({pins:e},{pinId:t,carouselSlotCurrentIndex:n})=>{const{carousel_data:o}=e&&t&&e[t]||{},{index:r}=o||{};return void 0!==n?{carouselSlotCurrentIndex:r||n||0}:{}}),(function(e){return class extends o.PureComponent{constructor(...e){super(...e),u(this,"state",{showEditModal:!1}),u(this,"onHide",()=>{this.setState({showEditModal:!1}),this.props.onToggleModal&&this.props.onToggleModal(!1)}),u(this,"handlePinEditButtonClick",Object(s.a)(e=>{e&&e.stopPropagation();const{component:t,onToggleModal:n}=this.props;n&&n(!0),Object(l.a)(101,{element:3,...t?{component:t}:{}}),this.setState({showEditModal:!0})}))}render(){const{pinId:t,onDelete:n,onSubmit:i,carouselSlotCurrentIndex:s}=this.props,{showEditModal:c}=this.state,l={...this.props,handlePinEditButtonClick:this.handlePinEditButtonClick};return r.a.createElement(o.Fragment,null,r.a.createElement(e,l),c&&r.a.createElement(a.a,{carouselSlotCurrentIndex:s,onDelete:n,onHide:this.onHide,onSubmit:i,pinId:t}))}}}))},eIuQ:function(e,t,n){n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return c}));var o=n("Ye/N");function r(e){return e?o.a._("Title too long. Make sure all cards' titles have less than 100 characters","Title entered is too long while editing a carousel pin and/or one of its pins","Title entered is too long while editing a carousel pin and/or one of its pins"):o.a._("Title too long. Make sure title has less than 100 characters","Title entered is too long while editing a pin","Title entered is too long while editing a pin")}function i(e){return e?o.a._("Description too long. Make sure all cards' descriptions have less than 500 characters","Description entered is too long while editing a carousel pin and/or one of its pins","Description entered is too long while editing a carousel pin and/or one of its pins"):o.a._("Description too long. Make sure description has less than 500 characters","Description entered is too long while editing a pin","Description entered is too long while editing a pin")}function s(e){return o.a._("Too many mentions. Make sure you have at most 5.","editPinModal.errorMessages.userMentionOverLimit","Too many mentions used in the description")}function a(e){return e?o.a._("Note too long. Make sure all cards' notes have less than 500 characters","User note entered is too long while editing a carousel pin and/or one of its pins","User note entered is too long while editing a carousel pin and/or one of its pins"):o.a._("Note too long. Make sure note has less than 500 characters","User note entered is too long while editing a pin","User note entered is too long while editing a pin")}function c(e){return e?o.a._("Need to provide a valid URL. Make sure all cards' links are valid","Invalid URL/link provided while editing a carousel pin and/or one of its pins","Invalid URL/link provided while editing a carousel pin and/or one of its pins"):o.a._("Need to provide a valid URL. Make sure the link is valid","Invalid URL/link provided while editing a pin","Invalid URL/link provided while editing a pin")}},jHGc:function(e,t,n){n.r(t),n.d(t,"PinRepEditButton",(function(){return c}));var o=n("q1tI"),r=n.n(o),i=n("Ye/N"),s=n("dtqy"),a=n("n6mq");function c({handlePinEditButtonClick:e,style:t,useLegoStyles:n=!1,usePersistentOneClickSaveStyles:o,wrappingIconStyle:s}){const c=r.a.createElement(a.o,{accessibilityLabel:i.a._("Edit","edit button on pin","edit button on pin"),bgColor:t&&t.bgColor||"white",icon:"edit",iconColor:t&&t.iconColor||"darkGray",onClick:({event:t})=>e(t),size:t&&t.size||"md"});return n||o?r.a.createElement("div",{style:{...s||{}}},c):c}t.default=Object(s.a)(c)},kwau:function(e,t,n){var o=n("/MKj");t.a=Object(o.connect)(({viewer:e})=>({viewer:e}))(({children:e,viewer:t})=>e(t))},mEMi:function(e,t,n){n.d(t,"a",(function(){return u}));var o=n("q1tI"),r=n.n(o),i=n("DzJC"),s=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const c=200,l=({scrollTop:e,clientHeight:t,scrollHeight:n},o)=>{return e+t+(o?o(t):2*t)>n};class u extends r.a.PureComponent{constructor(...e){super(...e),a(this,"setContainerRef",e=>{this.containerRef=e}),a(this,"fetchMoreIfNecessary",s()(()=>{const{fetchMore:e,scrollBuffer:t}=this.props;e&&this.containerRef&&l(this.containerRef,t)&&e()},c))}componentDidMount(){setTimeout(this.fetchMoreIfNecessary)}componentDidUpdate(){this.fetchMoreIfNecessary()}render(){const{children:e}=this.props;return e({onScroll:this.fetchMoreIfNecessary,setRef:this.setContainerRef})}}},mvLR:function(e,t,n){function o(e){let t=!1;return{promise:new Promise((n,o)=>{e.then(e=>t?o({isCanceled:!0}):n(e),e=>o(t?{isCanceled:!0}:e))}),cancel(){t=!0}}}n.d(t,"a",(function(){return o}))},"q/rS":function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));const o={HEADING:"story_pin_heading_block",IMAGE:"story_pin_image_block",INGREDIENT:"story_pin_ingredient_block",LINK:"story_pin_link_block",PARAGRAPH:"story_pin_paragraph_block",SUPPLY:"story_pin_supply_block",VIDEO:"story_pin_video_block"},r={alignment:1,hex_color:"#111111",highlight_color:"#FFFFFF",vertical_alignment:1},i={...r,font:{default_size:28,letter_spacing:-.4,line_height:1.25,name:"Graphik Regular",url:"https://pinterest-taipei.s3.amazonaws.com/Graphik-Regular.otf"},font_size:28}},vxan:function(e,t,n){n.d(t,"a",(function(){return s}));var o=n("q1tI"),r=n("mvLR");function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t,n;return n=t=class extends o.Component{constructor(...e){super(...e),i(this,"makeCancelablePromise",(e,t)=>{if(t){const e=this.cancelCallbackMap[t];e&&(e(),delete this.cancelCallbackMap[t])}const{cancel:n,promise:o}=Object(r.a)(e);return t?this.cancelCallbackMap[t]=n:this.cancelCallbacks.push(n),o}),i(this,"cancelCallbacks",[]),i(this,"cancelCallbackMap",{})}componentWillUnmount(){[...Object.keys(this.cancelCallbackMap).map(e=>this.cancelCallbackMap[e]),...this.cancelCallbacks].forEach(e=>e()),this.cancelCallbacks=[],this.cancelCallbackMap={}}render(){return o.createElement(e,Object.assign({},this.props,{makeCancelablePromise:this.makeCancelablePromise}))}},i(t,"displayName",`WithPromiseCancellation(${e.displayName||e.name||"Component"})`),n}},"zy/z":function(e,t,n){var o=n("q1tI"),r=n.n(o),i=n("Cufx"),s=n("Ye/N"),a=n("eOdZ"),c=n("LT60"),l=n("vxan"),u=n("joD6"),d=n("fArA"),h=n("TiQD"),p=n("n6mq");function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const m=5,g=27,_=38,y=40,b=13;var E=Object(d.compose)(l.a,u.a)(class extends r.a.PureComponent{constructor(...e){super(...e),f(this,"state",{isOpen:this.props.editing,recommendations:[],selectedIndex:0,resourceLoaded:!1}),f(this,"onDismiss",()=>{this.setState({isOpen:!1})}),f(this,"mounted",!1),f(this,"addMention",e=>{this.props.addMention(e),this.setState({recommendations:[]})}),f(this,"handleKeyDown",e=>{const t={[_]:this.handlePrevMention,[y]:this.handleNextMention,[g]:this.handleClose,[b]:this.handleSubmit},n=e&&e.keyCode;n&&Object.keys(t).includes(n.toString())&&t[n](e)}),f(this,"handlePrevMention",e=>{e.preventDefault(),this.state.selectedIndex>0&&this.setState(e=>({selectedIndex:e.selectedIndex-1}))}),f(this,"handleNextMention",e=>{e.preventDefault(),this.state.selectedIndex<this.state.recommendations.length-1&&this.setState(e=>({selectedIndex:e.selectedIndex+1}))}),f(this,"handleClose",e=>{e.preventDefault(),e.stopPropagation(),this.setState({recommendations:[]})}),f(this,"handleSubmit",e=>{e.preventDefault(),this.addMention(this.state.recommendations[this.state.selectedIndex])}),f(this,"callResource",e=>{const{makeCancelablePromise:t,viewer:n,inMentionWebExp:o}=this.props;o?t(a.a.create("UserMentionTypeaheadResource",{query:e,num_people:m}).callGet(),"userMentionTypeahead").then(e=>{if(!this.mounted)return;const t=e.resource_response.data;this.setState({recommendations:t.filter(e=>e.id!==(n.id||null)),resourceLoaded:!0})}).catch(({isCanceled:e})=>{e||this.setState({resourceLoaded:!1})}):t(a.a.create("TypeaheadResource",{num_boards:0,count:10,term:e,tag:"pinners"}).callGet(),"typeahead").then(e=>{if(!this.mounted)return;const t=e.resource_response.data;this.setState({recommendations:t.items.filter(e=>e.id!==(n.id||null)).slice(0,m),resourceLoaded:!0})}).catch(({isCanceled:e})=>{e||this.setState({resourceLoaded:!1})})})}componentDidMount(){this.mounted=!0,this.callResource(this.props.query),window.addEventListener("keydown",this.handleKeyDown)}UNSAFE_componentWillReceiveProps(e){e.query!==this.props.query&&""!==e.query&&this.callResource(e.query)}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyDown),this.mounted=!1}render(){const{recommendations:e,resourceLoaded:t,selectedIndex:n}=this.state,{anchor:o,idealDirection:a,inMentionWebExp:l}=this.props,u=a||"down",d="flyout_"+this.state.recommendations.length;return t&&e.length>0&&r.a.createElement(c.a,null,r.a.createElement(p.r,null,r.a.createElement(p.c,{position:"absolute",top:!0,dangerouslySetInlineStyle:{__style:{zIndex:h.a}}},r.a.createElement(p.k,{key:d,anchor:o,idealDirection:u,onDismiss:this.onDismiss,positionRelativeToAnchor:!1,size:"md"},r.a.createElement(p.c,{padding:2,width:"100%"},e.map((e,t)=>r.a.createElement(p.P,{onTouch:()=>this.addMention(e),key:e.id,onMouseEnter:()=>{this.setState({selectedIndex:t})}},r.a.createElement(p.c,{display:"flex",alignItems:"center",color:t===n?"lightGray":"transparent",rounding:4},r.a.createElement(p.c,{padding:1},r.a.createElement(i.a,{size:"sm",src:e.image_medium_url,name:e.full_name,verified:e.verified_identity&&e.verified_identity.verified})),r.a.createElement(p.c,{marginStart:2,marginEnd:2,overflow:"hidden"},r.a.createElement(p.K,{truncate:!0,weight:"bold",color:"darkGray"},e.full_name),l&&r.a.createElement(p.c,{dangerouslySetInlineStyle:{__style:{whiteSpace:"nowrap"}}},r.a.createElement(p.K,{size:"sm",color:"darkGray"},e.username,e.explicitly_followed_by_me&&` • ${s.a._("Following","mentions.mentionsFlyout.following","Label to tell the user that they are viewing a user they follow")}`)))))))))))}}),I=n("/5zs"),T=n("zywm"),x=n("pLLR");function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C=/@[a-zA-Z0-9_-]*/,S="g",w=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Escape","Shift","Alt","Control","Meta"],R=0,A=13,v={boxSizing:"border-box",display:"inline-block",minWidth:"100%"};class k extends o.PureComponent{constructor(...e){super(...e),M(this,"state",{flyoutCursorIndex:0,isMentionFlyoutOpen:!1,mentionQuery:"",textValue:""}),M(this,"getTextCursorPosition",()=>{const e=window.getSelection(),t=e.getRangeAt(0),n=e.anchorNode;return{cursorIndex:t.startOffset,selectedElement:n}}),M(this,"getHTMLCursorPosition",()=>{const{cursorIndex:e,selectedElement:t}=this.getTextCursorPosition();if(t){let n=e;const o=t.parentNode;o!==this._textAreaRef&&(n+=o.outerHTML.length-o.innerHTML.length-(3+o.tagName.length));let r=t.previousSibling;for(;r;)n+=r.outerHTML&&r.outerHTML.length||r.textContent.length,r=r.previousSibling;return{cursorIndex:n,parentElement:o}}return{cursorIndex:-1}}),M(this,"setRef",e=>{this.props.setRef(e),this._textAreaRef=e}),M(this,"focusTextAreaAndPostionCursor",(e=!1)=>{const t=window.getSelection(),n=document.createRange();if(e&&this._textAreaRef)n.selectNodeContents(this._textAreaRef),n.collapse(!1);else if(t.anchorNode){const e=t.getRangeAt(0),o=e.startOffset,r=e.startContainer;n.setStart(r,o),n.collapse(!0),this._textAreaRef&&r===this._textAreaRef&&(n.selectNodeContents(this._textAreaRef),n.collapse(!1))}else this._textAreaRef&&(n.selectNodeContents(this._textAreaRef),n.collapse(!1));t.removeAllRanges(),t.addRange(n),this._textAreaRef&&this._textAreaRef.focus()}),M(this,"handleKeyDown",e=>{const{handleEnter:t}=this.props;!this.state.isMentionFlyoutOpen&&e.which===A&&t&&(e.preventDefault(),t(e.target.textContent))}),M(this,"handleKeyUp",e=>{const{parentElement:t}=this.getHTMLCursorPosition(),{cursorIndex:n}=this.getTextCursorPosition(),o=n===t.textContent.length,r=t.className===T.b;r&&t.getAttribute(T.a)>t.textContent.length?this.handleRemoveMention(t):!r||0===e.which||w.includes(e.key)||o?t.className===T.b&&o&&this.placeCaretAfterNode(t):this.handleRemoveSpan(t);const i=e.target.textContent;this.props.onChange&&this.props.onChange(i!==this.props.textValue),this.props.onTextChange&&this.props.onTextChange()}),M(this,"handleAddMention",e=>{const t=this.state.flyoutCursorIndex,n=t+this.state.mentionQuery.length+1,o=this._textAreaRef,r=o&&o.innerHTML.slice(0,t)||"",i=o&&o.innerHTML.slice(n)||" ",s=e.first_name||e.full_name,a=this.inMentionWebExp?`@${e.username}`:s,c=`${r}${Object(T.c)(e.id,a).outerHTML}${i}`;this.props.updateTags&&this.props.updateTags(e),this.setState({textValue:c,mentionQuery:"",isMentionFlyoutOpen:!1},()=>{this.focusTextAreaAndPostionCursor(),this.props.onTextChange&&this.props.onTextChange()})}),M(this,"handleRemoveMention",e=>{this._textAreaRef&&this._textAreaRef.replaceChild(document.createTextNode(""),e)}),M(this,"handleRemoveSpan",e=>{this._textAreaRef&&(this._textAreaRef.replaceChild(document.createTextNode(e.textContent),e),this.setState({textValue:this._textAreaRef&&this._textAreaRef.innerHTML||""},this.focusTextAreaAndPostionCursor))}),M(this,"handleInput",e=>{const{cursorIndex:t}=this.getHTMLCursorPosition();let n="";const o=e.target.innerHTML,r=new RegExp(C,S);let i=r.exec(o),s=r.lastIndex<t;for(;i&&s;)i=r.exec(o),s=r.lastIndex<t;n=i&&i.index<t?i[R]:"";const a=this.state.isMentionFlyoutOpen?this.state.flyoutCursorIndex:o.slice(0,t).lastIndexOf("@"),c=n.substring(1);this.setState({flyoutCursorIndex:a,mentionQuery:c,isMentionFlyoutOpen:!!n}),this.props.handleInput&&this.props.handleInput(e.target.textContent)}),M(this,"handlePaste",e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}),M(this,"placeCaretAfterNode",e=>{const t=e.textContent,n=e.getAttribute(T.a),o=t.substring(n),r=t.substring(0,n);e.innerHTML=r;const i=document.createRange();i.setStartAfter(e);const s=document.createTextNode(o);i.insertNode(s),i.collapse(!1);const a=window.getSelection();a.removeAllRanges(),a.addRange(i)})}componentDidMount(){this.inMentionWebExp=new I.c(this.props.requestContext,"cp_mention_web").enabled(),this.setState({textValue:this.props.replyToObject?Object(T.f)(this.props.existingTags,this.props.taggedUsers,this.props.textValue,this.props.replyToObject,this.inMentionWebExp):Object(T.f)(this.props.existingTags,this.props.taggedUsers,this.props.textValue)},()=>{this.focusTextAreaAndPostionCursor(!0)})}componentDidUpdate(e,t){this.state.isMentionFlyoutOpen&&!this.props.shouldLoseFocus&&this.focusTextAreaAndPostionCursor()}render(){const{disabled:e,style:t={},suggestionAnchor:n,handleBlur:o,handleFocus:i}=this.props,{isMentionFlyoutOpen:s,mentionQuery:a,textValue:c}=this.state;return r.a.createElement(p.c,{alignItems:"center",width:"100%"},r.a.createElement("div",{contentEditable:!e,"data-test-id":"mentionsInput",name:"mentionsInput",onBlur:o,onFocus:i,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,ref:this.setRef,role:"textbox",style:Object.assign({},t,v),tabIndex:"0",dangerouslySetInnerHTML:{__html:c}}),n&&s&&r.a.createElement(E,{addMention:this.handleAddMention,anchor:n,query:a,inMentionWebExp:this.inMentionWebExp}))}}M(k,"defaultProps",{handleFocus:()=>{},existingTags:[],taggedUsers:[]});t.a=Object(x.f)(k)},zywm:function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return l}));const o="data-length",r="communityEditorMention",i=e=>{let t=e.previousSibling,n=0;for(;t;)n+=t.textContent.length,t=t.previousSibling;return n},s=e=>{let t=[];if(e&&e.children){Array.from(e.children).forEach(e=>{if(e.className===r){const n=e.getAttribute("data-user-id")||"",o=e.textContent||"";t=t.concat({object_id:n,length:o.length,offset:i(e),tag_type:1})}})}return t},a=(e,t,n)=>(n&&n.forEach(e=>{t[e.id]=e}),JSON.stringify(s(e))),c=(e,t,n=!1)=>{const i=document.createElement("span");return i.setAttribute("style","font-weight: bold; color: #0074e8"),i.setAttribute("data-user-id",`${e}`),i.setAttribute(o,`${t.length}`),n&&i.setAttribute("data-reply-to","true"),i.setAttribute("class",r),i.innerText=t,i},l=(e,t,n,o={},r)=>{let i=0,s="";if(o&&o.user){const t=`@${o.user.username}`,a=o.user.first_name||o.user.full_name,l=r?t:a;if((!n||n.substring(i,l.length)===l)&&(s=`${c(o.user.id,l,!0).outerHTML} `,i=l.length,e.shift(),n&&n.trim().length===l.length))return s}return n&&(e.forEach((e,o)=>{const r=t&&t.length>0&&t[o].id||e.object_id,a=n.substr(e.offset,e.length),l=n?n.substring(i,e.offset):"";i=e.offset+e.length,s=`${s}${l}${c(r,a).outerHTML}`}),s=`${s}${n.substring(i)}`),s}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/js/78-812c76bc2643e06042c4.mjs.map
